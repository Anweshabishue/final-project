<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Question Paper Generator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    }
    
    body {
      background-color: #f8f9fa;
    }
    
    /* .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 24px;
      border-bottom: 1px solid #e1e4e8;
      background-color: white;
    }
     */
     .navbar {
      border-bottom: 1px solid #e1e4e8;
      background-color: white;
      padding: 0.75rem 1rem;
    }
    
    .nav-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo span {
      color: #3b82f6;
      font-weight: 600;
      font-size: 1.25rem;
    }
    
    .log-out {
      background-color: #3b82f6;
      color: white;
      border: none;
      border-radius: 0.375rem;
      padding: 0.5rem 1rem;
      font-weight: 500;
      cursor: pointer;
    }
    
    .log-out:hover {
      background-color: #2563eb;
    }
    
    .container {
      max-width: 1200px;
      margin: 20px auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      padding: 0 20px;
    }
    
    .panel {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 24px;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 24px;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 4px;
      font-weight: 500;
      color: #64748b;
    }
    
    .tab.active {
      background-color: #f1f5f9;
      color: #3b82f6;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #333;
    }
    
    .form-control {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    textarea.form-control {
      height: 100px;
      resize: vertical;
    }
    
    .question-row {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .marks-display {
      text-align: right;
      color: #64748b;
      font-size: 14px;
    }
    
    .total-marks {
      margin-top: 20px;
      font-weight: 600;
    }
    
    .difficulty-input {
      margin-bottom: 20px;
    }
    
    .generate-btn {
      background-color: #3b82f6;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      width: 100%;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .generate-btn:hover {
      background-color: #2563eb;
    }
    
    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .preview-title {
      font-size: 18px;
      font-weight: 500;
    }
    
    .preview-actions {
      display: flex;
      gap: 12px;
    }
    
    .preview-btn {
      color: #64748b;
      cursor: pointer;
      font-size: 18px;
    }
    
    .preview-content {
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #64748b;
    }
    
    .preview-icon {
      font-size: 48px;
      margin-bottom: 16px;
      color: #cbd5e1;
    }
    
    .preview-message {
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .preview-instruction {
      font-size: 14px;
      text-align: center;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }
      
      .question-row {
        grid-template-columns: 1fr 1fr;
      }
      
      .marks-display {
        grid-column: span 2;
        text-align: left;
        margin-top: 8px;
      }
    }
    .navbar {
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19) ;
      padding: 1rem;  
}
.logo span {
    font-weight: 600;
    font-size: 1.25rem;
    margin-left: 70px;
}
.nav-content {
     max-width: 1280px; 
      margin: 0 auto;  
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.log-out {
    height: 35px;
    width: 70px;
    padding: 0.5rem 1rem;
    color: white;
    background-color: blue;
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-content">
      <div class="logo">
        <span>TestMate</span>
      </div>
      <button class="log-out">Logout</button>
    </div>
  </nav>
  
  <div class="container">
    <div class="panel">
      <div class="tabs">
        <div class="tab active" data-tab="basic">Basic Details</div>
        <div class="tab" data-tab="questions">Questions</div>
        <div class="tab" data-tab="difficulty">Difficulty</div>
      </div>
      
      <div class="tab-content active" id="basic-tab">
        <div class="form-group">
          <label for="subject">Subject</label>
          <input type="text" id="subject" class="form-control" placeholder="e.g., Computer Science">
        </div>
        
        <div class="form-group">
          <label for="topics">Topics/Syllabus</label>
          <textarea id="topics" class="form-control" placeholder="Enter topics covered, one per line"></textarea>
        </div>
        
        <div class="form-group">
          <label for="duration">Duration (minutes)</label>
          <input type="number" id="duration" class="form-control" value="180">
        </div>
      </div>
      
      <div class="tab-content" id="questions-tab">
        <div class="question-row">
          <div>
            <label for="mc-count">Multiple Choice</label>
            <input type="number" id="mc-count" class="form-control" value="10">
          </div>
          <div>
            <label for="mc-marks">Marks Each</label>
            <input type="number" id="mc-marks" class="form-control" value="1">
          </div>
          <div class="marks-display">
            Total: 10 marks
          </div>
        </div>
        
        <div class="question-row">
          <div>
            <label for="sa-count">Short Answer</label>
            <input type="number" id="sa-count" class="form-control" value="5">
          </div>
          <div>
            <label for="sa-marks">Marks Each</label>
            <input type="number" id="sa-marks" class="form-control" value="2">
          </div>
          <div class="marks-display">
            Total: 10 marks
          </div>
        </div>
        
        <div class="question-row">
          <div>
            <label for="la-count">Long Answer</label>
            <input type="number" id="la-count" class="form-control" value="2">
          </div>
          <div>
            <label for="la-marks">Marks Each</label>
            <input type="number" id="la-marks" class="form-control" value="10">
          </div>
          <div class="marks-display">
            Total: 20 marks
          </div>
        </div>
        
        <div class="total-marks">
            Total: 40 marks
        </div>
      </div>
      
      <div class="tab-content" id="difficulty-tab">
        <div class="difficulty-input">
          <label for="easy">Easy Questions (%)</label>
          <input type="number" id="easy" class="form-control" value="30" min="0" max="100">
        </div>
        
        <div class="difficulty-input">
          <label for="medium">Medium Questions (%)</label>
          <input type="number" id="medium" class="form-control" value="50" min="0" max="100">
        </div>
        
        <div class="difficulty-input">
          <label for="hard">Hard Questions (%)</label>
          <input type="number" id="hard" class="form-control" value="20" min="0" max="100">
        </div>
      </div>
      
      <button class="generate-btn">
        Generate Paper
        <span>‚Üí</span>
      </button>
    </div>
    
    <div class="panel">
      <div class="preview-header">
        <div class="preview-title">Preview</div>
        <div class="preview-actions">
          <div class="preview-btn">‚¨áÔ∏è</div>
          <div class="preview-btn">üñ®Ô∏è</div>
          <div class="preview-btn" onclick="sharePaper()">üì§</div>
        </div>
      </div>
      
      <div class="preview-content">
        <div class="preview-icon">üìÉ</div>
        <div class="preview-message">No paper generated</div>
        <div class="preview-instruction">Configure the options and click generate to create a new question paper.</div>
      </div>
    </div>
  </div>

  <script>
    // Tab switching functionality
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        const tabId = tab.getAttribute('data-tab');
        document.getElementById(`${tabId}-tab`).classList.add('active');
      });
    });
  
    const mcCount = document.getElementById('mc-count');
    const mcMarks = document.getElementById('mc-marks');
    const saCount = document.getElementById('sa-count');
    const saMarks = document.getElementById('sa-marks');
    const laCount = document.getElementById('la-count');
    const laMarks = document.getElementById('la-marks');
    const totalMarksElement = document.querySelector('.total-marks');
  
    const calculateTotals = () => {
      const mcTotal = parseInt(mcCount.value || 0) * parseInt(mcMarks.value || 0);
      const saTotal = parseInt(saCount.value || 0) * parseInt(saMarks.value || 0);
      const laTotal = parseInt(laCount.value || 0) * parseInt(laMarks.value || 0);
      document.querySelectorAll('.marks-display')[0].textContent = `Total: ${mcTotal} marks`;
      document.querySelectorAll('.marks-display')[1].textContent = `Total: ${saTotal} marks`;
      document.querySelectorAll('.marks-display')[2].textContent = `Total: ${laTotal} marks`;
      const grandTotal = mcTotal + saTotal + laTotal;
      totalMarksElement.textContent = `Total Marks: ${grandTotal}`;
    };
  
    [mcCount, mcMarks, saCount, saMarks, laCount, laMarks].forEach(input => {
      input.addEventListener('change', calculateTotals);
      input.addEventListener('input', calculateTotals);
    });
  
    const easyPercent = document.getElementById('easy');
    const mediumPercent = document.getElementById('medium');
    const hardPercent = document.getElementById('hard');
  
    const validateDifficulty = () => {
      const easy = parseInt(easyPercent.value || 0);
      const hard = parseInt(hardPercent.value || 0);
      const clampedEasy = Math.max(0, Math.min(100, easy));
      const clampedHard = Math.max(0, Math.min(100, hard));
      if (clampedEasy !== easy) easyPercent.value = clampedEasy;
      if (clampedHard !== hard) hardPercent.value = clampedHard;
      const medium = 100 - clampedEasy - clampedHard;
      if (medium < 0) {
        hardPercent.value = 100 - clampedEasy;
        mediumPercent.value = 0;
      } else {
        mediumPercent.value = medium;
      }
    };
  
    [easyPercent, hardPercent].forEach(input => {
      input.addEventListener('change', validateDifficulty);
      input.addEventListener('input', validateDifficulty);
    });
  
    const generateBtn = document.querySelector('.generate-btn');
    const previewContent = document.querySelector('.preview-content');
  
    generateBtn.addEventListener('click', () => {
      const subject = document.getElementById('subject').value;
      const topics = document.getElementById('topics').value;
      const duration = document.getElementById('duration').value;
  
      if (!subject) {
        alert('Please enter a subject');
        return;
      }
  
      if (!duration || duration <= 0) {
        alert('Please enter a valid duration');
        return;
      }
  
      const payload = {
        subject,
        topics,
        duration,
        questions: {
          mc: { count: mcCount.value, marks: mcMarks.value },
          sa: { count: saCount.value, marks: saMarks.value },
          la: { count: laCount.value, marks: laMarks.value },
        },
        difficulty: {
          easy: easyPercent.value,
          medium: mediumPercent.value,
          hard: hardPercent.value
        }
      };
  
      previewContent.innerHTML = `
        <div style="text-align: center; padding: 20px;">Generating question paper...</div>
      `;
  
      fetch("/generate_question_paper", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data => {
        if (data.question_paper) {
          previewContent.innerHTML = `
            <div style="padding: 20px; white-space: pre-wrap;">
              ${data.question_paper}
            </div>
          `;
        } else {
          previewContent.innerHTML = `<p style="color: red;">${data.error || 'Failed to generate question paper.'}</p>`;
        }
      })
      .catch(err => {
        previewContent.innerHTML = `<p style="color: red;">Error: ${err.message}</p>`;
      });

    //Save to DB
fetch("/save_question_paper", {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    subject,
    topics,
    duration,
    questions: payload.questions,
    difficulty: payload.difficulty,
    content: data.question_paper
  })
})
.then(res => res.json())
.then(saveResp => {
  console.log("Saved with ID:", saveResp.paper_id);
});

     });
  
    // Initialize on load
    calculateTotals();
    validateDifficulty();

    document.querySelector('.preview-actions .preview-btn:nth-child(1)').addEventListener('click', () => {
  const element = document.querySelector('.preview-content');
  html2pdf().from(element).save('question_paper.pdf');
});

document.querySelector('.preview-actions .preview-btn:nth-child(2)').addEventListener('click', () => {
  const printWindow = window.open('', '_blank');
  printWindow.document.write(document.querySelector('.preview-content').innerHTML);
  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
  printWindow.close();
});

document.querySelector('.preview-actions .preview-btn:nth-child(3)').addEventListener('click', async () => {
  const textContent = document.querySelector('.preview-content').innerText;
  if (navigator.share) {
    try {
      await navigator.share({
        title: 'Generated Question Paper',
        text: textContent,
      });
    } catch (error) {
      console.error('Error sharing:', error);
    }
  } else {
    alert('Sharing is not supported in your browser.');
  }
});

function sharePaper() {
  const text = document.querySelector(".preview-content").innerText;
  
  if (navigator.share) {
    navigator.share({
      title: 'Generated Question Paper',
      text: text
    })
    .then(() => console.log('Shared successfully'))
    .catch(err => alert('Share failed: ' + err));
  } else {
    alert("Sharing is not supported in your browser.");
  }
}


  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</body>
</html>
